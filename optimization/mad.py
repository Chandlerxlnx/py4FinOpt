from cvxopt import solvers, matrix
import collections
import numpy as np

def mad(returns, m):
    returns = np.asmatrix(returns)
    means = np.mean(returns, axis=1)
    N, T = returns.shape
    CMAD = np.zeros((T+N, 1)) + ([1./T for _ in range(T)]+[0.0 for _ in range(N)])
    print CMAD    
    beqMAD = [1]

    AMAD1 = -np.concatenate((np.eye(T), np.transpose(-returns+(means*np.ones((1, T))))), axis=1)
    AMAD2 = -np.concatenate((np.eye(T), np.transpose(returns-(means*np.ones((1, T))))), axis=1)
    AMAD3 = np.zeros((T+N, 1)) + ([0.0 for _ in range(T)] + list(-means))
    
    AMAD = np.concatenate((AMAD1, AMAD2, AMAD3), axis=0)

    bMAD = np.zeros((1, T+1))
    bMAD[0, T] = -m
    
    AeqMAD = [0.0 for _ in range(T)] + [1.0 for _ in range(N)]

    solvers.lp(
        matrix(CMAD),
        matrix(AMAD),
        matrix(bMAD),
        matrix(AeqMAD),
        matrix(beqMAD)
    )

    print sol['x']


if __name__ == '__main__':
    stocks = ['WMT', 'XOM']
    returns = [
        [
            0.99374805, 1.00833595, 0.99703634, 1.02158949, 1.01408882,
            0.96949562, 1.01588785, 1.01901257, 1.02452603, 0.99280364,
            1.02455621,  1.00736356,  1.0209259 ,  1.02835884,  0.99658703,
            1.00958904,  1.00257802,  1.0014887 ,  0.98702703,  0.99288061,
            0.96800883,  1.01994302,  0.98086592,  0.98177417,  1.013343  ,
            1.00973236,  1.03217576,  1.00576765,  0.9989077 ,  1.00970476,
            0.98240152,  0.96375913,  0.9908493 ,  0.99379509,  0.99462756,
            1.02437956,  1.01980904,  0.98057574,  0.97905088,  1.02780204,
            1.01189633,  1.00475857,  1.01309375,  1.01154957,  1.01617507,
            1.00735688,  1.01513743,  0.99254415,  0.9766737 ,  0.99163406,
            1.01347122,  1.00281955
        ],
        [
            1.00731284,  1.01328904,  1.0103218 ,  0.98149038,  0.9904482,
            0.99715628,  1.00954743,  1.00257922,  0.99485483,  1.00443295,
            0.99914184,  1.00920245,  0.98772036,  0.99987691,  0.98264188,
            1.00626409,  1.02303287,  1.00815383,  1.01798648,  0.99750978,
            0.98846885,  1.01082381,  0.99048186,  0.98786787,  1.00972763,
            1.01348748,  1.01996198,  1.01898882,  0.99599863,  0.97004132,
            0.99337357,  0.96902918,  0.99557468,  0.99592542,  1.00099182,
            1.01325242,  1.00293363,  0.98013406,  0.99328525,  1.00738608,
            1.00683485,  1.00481363,  1.02100479,  1.03946102,  1.02731481,
            0.99729608,  0.98395843,  1.02319173,  0.99640934,  1.03536036,
            1.02871438,  0.99693381
        ]
    ]
    
    
    mad(returns, 1.005)

